---
title: "Motorcycle claims - Wasa insurance 1994 to 1998"
author: "Christian Duffau-Rasmussen"
date: "`r Sys.Date()`"
bibliography: litlist.bib
output: github_document
---

```{r}
library(ggplot2)
library(insuranceData)
library(ROCR)
data(dataOhlsson)
```

## The data set

The data comes from the former Swedish insurance company Wasa, and concerns partial casco insurance, for motorcycles. It contains aggregated data on all insurance policies and claims during 1994-1998.

```{r}
head(dataOhlsson)
```

The variables are:

- `agarald` The owners age, between 0 and 99, a numeric vector
- `kon` The owners age, between 0 and 99, a factor with levels K M
- `zon` Geographic zone numbered from 1 to 7, in a standard classification of all Swedish parishes, a numeric vector
- `mcklass` MC class, a classification by the so called EV ratio, defined as (Engine power in kW x 100) / (Vehicle weight in kg + 75), rounded to the nearest lower integer. The 75 kg represent the average driver weight. The EV ratios are divided into seven classes, a numeric vector
- `fordald` Vehicle age, between 0 and 99, a numeric vector
- `bonuskl` Bonus class, taking values from 1 to 7. A new driver starts with bonus class 1; for each claim-free year the bonus class is increased by 1. After the first claim the bonus is decreased by 2; the driver can not return to class 7 with less than 6 consecutive claim free years, a numeric vector
- `duration` the number of policy years, a numeric vector
- `antskad` the number of claims, a numeric vector
- `skadkost` the claim cost, a numeric vector

## Claim classifier

We would like classify which policies would experience claims and which will not. So first we define the variable "has_claim".

```{r}
dataOhlsson[,"has_claim"] <- factor(dataOhlsson$antskad>0)
```

```{r}
table(dataOhlsson$has_claim)/nrow(dataOhlsson)
```
We see that claims are very rare and only 1% of all policies have claims.

```{r}
set.seed(123)
test.pct <- 0.5
mask <- runif(nrow(dataOhlsson))>test.pct
train.data <- dataOhlsson[mask, ]
test.data <- dataOhlsson[!mask, ]
```
We reserve approximately `r sprintf("%.0f%%", test.pct*100)` of the data set for testing, so the training set conatians `r nrow(train.data)` observations and the remaining `r nrow(test.data)` observations are used for testing.


## Logistic regression

```{r}
model <- glm(has_claim ~ agarald + kon + factor(zon) + factor(mcklass) + fordald + factor(bonuskl) + duration, family=binomial(link='logit'), data=train.data)
summary(model)
```
```{r}
anova(model, test='Chisq')
```

```{r}
p <- predict(model, newdata=test.data, type="response")
pr <- prediction(p, test.data$has_claim)
prf <- performance(pr, measure = "tpr", x.measure = "fpr")
plot(prf)
```

```{r}
auc <- performance(pr, measure = "auc")
auc <- auc@y.values[[1]]
auc
```



## References